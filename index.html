
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>We Are Family</title>
<script type="text/javascript" src="js/jquery-1.11.0.js"></script>
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/style.css">
<script src="js/bootstrap.js"></script>

<!-- Include the plugin's CSS and JS: -->
<script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
<link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>
<script type="text/javascript" src="js/bootstrap-slider.js"></script>
<link rel="stylesheet" href="css/slider.css" type="text/css"/>

<script src="js/movie-network.js"></script>
<link rel="stylesheet" href="css/movie-network.css"/>

<script src="data/data_new.js"></script>
<script src="data/season.js"></script>
<script src="js/heatmap.js"></script>

<script type="text/javascript">
/********for heatmap start************/
data = [
{row: 1, col: 1, value: 0},
{row: 1, col: 2, value: 0},
{row: 1, col: 3, value: 0},
{row: 1, col: 4, value: 0},
{row: 1, col: 5, value: 0},
{row: 1, col: 6, value: 0},
{row: 1, col: 7, value: 0},
{row: 1, col: 8, value: 0},
{row: 1, col: 9, value: 0},
{row: 1, col: 10, value: 0},
{row: 1, col: 11, value: 0},
{row: 1, col: 12, value: 0},
{row: 1, col: 13, value: 0},
{row: 1, col: 14, value: 0},
{row: 1, col: 15, value: 0},
{row: 1, col: 16, value: 0},
{row: 1, col: 17, value: 0},
{row: 1, col: 18, value: 0},
{row: 1, col: 19, value: 0},
{row: 1, col: 20, value: 0},
{row: 1, col: 21, value: 0},
{row: 1, col: 22, value: 0},
{row: 1, col: 23, value: 0},
{row: 1, col: 24, value: 0},
{row: 1, col: 25, value: 0},
];
hcrow = [1]; // change to gene name or probe id
hccol = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]; // change to gene name or probe id
rowLabel = ['Homer Simpson']; // change to gene name or probe id
colLabel = ['Season 1','Season 2','Season 3','Season 4','Season 5','Season 6','Season 7','Season 8','Season 9','Season 10','Season 11','Season 12','Season 13','Season 14','Season 15','Season 16','Season 17','Season 18','Season 19','Season 20','Season 21','Season 22','Season 23','Season 24','Season 25']; // change to contrast name
/********for heatmap end************/

  var characterFilter = {
  	  "filter": 1,
	  "ageMin": 0,
	  "ageMax": 100,
	  "male": 1,
	  "female": 1,
	  "selectedIndex": -1,
  }
  
  var selectedSeasons=[];
  var selectedEpisodes=[];
  
  var currentStats = {
	  "numofFemale": 0,
	  "numofMale": 0,
  }

  $(document).ready(function() {

    $('.multiselect').multiselect();
    
    characterList();
    episodeList();
    
    
    $('#locationSelect').append('<option value="">' + 'Select a location' + '</option>');
        

	for (var i=0; i<seasons.length;i++){    
		try{
			$('#seasonSelect').append('<option value="' + (i+1).toString() + '">Season ' + seasons[i]['season'] + '-' + seasons[i]['years'] + '</option>');
		}
		catch(err){
			console.log(i);
		}
	}
	
	for (var i=0; i<locations.length;i++){    
		try{
			$('#locationSelect').append('<option value="' + i + '">' + locations[i]['location'] + '</option>');
		}
		catch(err){
			console.log(i);
		}
	}	
    $('#characterSelect').multiselect({
    	includeSelectAllOption: true,
    	enableFiltering: true,
    	label: function(element) {
        if (element.value === 'multiselect-all')
            return element.innerHTML;
        var el = $(element),
            ret = '<ul class="charsel">',
            img = el.data('image'),
            page = el.text(),
            name = el.data('name');

        if (img)
            ret += '<li><img class="charsel-image" width="20px" src="'+ img + '" alt="'+ page +'"></li>';
        ret += '<li class="charsel-name">' + page + '</li>';
        if (page !== name)
            ret += '<li class="charsel-fullname">' + img + '</li>';
        ret += '</ul>';
        return ret;
    },
    	maxHeight: 150
    });
    $('#characterSelect').change(function(){
    	var selected = document.getElementById('characterSelect');
    	var selectedIndex = selected.options[selected.selectedIndex].value;
    	//alert(selectedIndex);
    	var img = document.getElementById('selectedCharacterIcon');
    	if(images[characters[selectedIndex]['image']]!=undefined){
	    	img.src=images[characters[selectedIndex]['image']];
    	}
    	else{
	    	img.src="http://wsamarketplace.com/wp-content/themes/classifiedstheme/thumbs/no-image.jpg";
    	}
    	for(var i=0; i<data.length;i++){
    		data[i]["value"] = 0;
		}
		rowLabel[0] = characters[selectedIndex]["name"];   	
		for (var c in characters){
		    if (characters.hasOwnProperty(c)) {
		    	//console.log(characters[c]);
				for(var i;i<characters[c]["appearances"].length;i++){
					data[episodes[characters[c]["appearances"][i]]["s"]-1]["value"]++;
				}
			}
		}/*
    	for (var i=0; i<characters[selectedIndex]['appearances'].length;i++){
    		for (var j=0; j<episodes.length;j++){    		
    			if (characters[selectedIndex]['appearances'][i] == episodes[j]['title']){
	    			data[episodes[j]["s"]-1]["value"]++;	   	    				
	    			//console.log("dfdf"); 	    						
    			}    			
    		}
    	}*/
    	console.log(data);
    	/******************************* heap map start**********************/
    	heatmap();
      /***********************heat map end***********************/
    	
    });
    
    $('#seasonSelect').multiselect({
    	includeSelectAllOption: true,
    	enableFiltering: true,
    	maxHeight: 150
    });
    
    $('#seasonSelect').change(function (){  
	  var o = document.getElementById("seasonSelect");  
	  var str = "";  
	  selectedSeasons = [];
	  for(i=0;i<o.length;i++){     
        if(o.options[i].selected){   	
            selectedSeasons.push(o.options[i].value);  
        }  
      }  
      episodeList();
      //console.log(selectedSeasons);
    });
    
    $('#episodeSelect').multiselect({
    	includeSelectAllOption: true,
    	enableFiltering: true,
    	maxHeight: 150
    });
    $('#episodeSelect').change(function (){  
	  var o = document.getElementById("episodeSelect");  
	  var str = "";  
	  selectedEpisodes = [];
	  for(i=0;i<o.length;i++){     
        if(o.options[i].selected){   	
            selectedEpisodes.push(o.options[i].value);  
        }  
      }  
      episodeList();
      //console.log(selectedSeasons);
    });

    
    $('#locationSelect').multiselect({
    	includeSelectAllOption: true,
    	enableFiltering: true,
    	maxHeight: 150
    });
    
    $('#male').change(function(){
       if(document.getElementById('male').checked){
		   characterFilter['male'] = 1;
       }
       else{
		   characterFilter['male'] = 0;
       }
       characterList();
       //console.log(characterFilter);
    });
    
    $('#female').change(function(){
       if(document.getElementById('female').checked){
		   characterFilter['female'] = 1;
       }
       else{
		   characterFilter['female'] = 0;
       }
       //console.log(characterFilter);
       characterList();
    });
    $("#ageSlider").slider({});
    $("#ageSlider").on('slide', function(slideEvt) {
		//console.log(slideEvt.value);
		characterFilter['ageMin'] = slideEvt.value[0];
		characterFilter['ageMax'] = slideEvt.value[1];
		characterList();
		//console.log(characterFilter);
	});
    
 });
  
  function characterList(){
     cleanOptions('characterSelect');
     currentStats['numofMale'] = 0;
     currentStats['numofFemale'] = 0;
     $('#characterSelect').append('<option value="">' + 'Select a character' + '</option>');
     var numofShow = 0;
  	 if (characterFilter['filter']==0){		
		for (var i=0; i<characters.length;i++){    
		   $('#characterSelect').append('<option value="' + i + '">' + characters[i]['name'] + '</option>');
		}
	 }
	 else{
	 	for (var c in characters){
	 		var filtered = 0;
		    if(characters[c]['gender']=="M")currentStats['numofMale']++;
		    if(characters[c]['gender']=="W")currentStats['numofFemale']++;
		    if((characterFilter['male']==0 && characters[c]['gender']=="M") || (characters[c]['gender']=="W" && characterFilter['female']==0)){
			    filtered = 1;
		    }
		    
		    if(parseInt(characters[c]['age'][0]) < characterFilter['ageMin'] || parseInt(characters[c]['age'][0]) > characterFilter['ageMax']){
		    	filtered=1;
		    	//console.log("here");
		    }
		    
		    //console.log(characters[i]['gender']);    
		    if(filtered == 0){
			    $('#characterSelect').append('<option value="' + c + '" data-name="'+characters[c]['page']+'" data-image="'+images[characters[c]['image']]+'">' + c + '</option>');
			    numofShow++;
		    }  		
	 	}
	 	/*
		for (var i=0; i<characters.length;i++){
		    var filtered = 0;
		    if(characters[i]['gender']=="M")currentStats['numofMale']++;
		    if(characters[i]['gender']=="W")currentStats['numofFemale']++;

		    if((characterFilter['male']==0 && characters[i]['gender']=="M") || (characters[i]['gender']=="W" && characterFilter['female']==0)){
			    filtered = 1;
		    }
		    
		    if(parseInt(characters[i]['age'][0]) < characterFilter['ageMin'] || parseInt(characters[i]['age'][0]) > characterFilter['ageMax']){
		    	filtered=1;
		    	//console.log("here");
		    }
		    
		    //console.log(characters[i]['gender']);    
		    if(filtered == 0){
			    $('#characterSelect').append('<option value="' + i + '">' + characters[i]['name'] + '</option>');
			    numofShow++;
		    }  		    
		}
		*/
		//console.log(numofShow);		
	 }
  }
  
  function episodeList(){
  	cleanOptions('episodeSelect');
  	var numofShow = 0;
  	if(selectedSeasons.length < 1){
	  	for (var i=0; i<episodes.length;i++){      
			$('#episodeSelect').append('<option value="' + i + '">' + episodes[i]['title'] + '-' + episodes[i]['airing'] +'</option>');
			numofShow++;
		}
	}
	else{
		for (var i=0; i<episodes.length;i++){    
			if(selectedSeasons.indexOf(episodes[i]['s'].toString())!=-1){  
				$('#episodeSelect').append('<option value="' + i + '">' + episodes[i]['title'] + '-' + episodes[i]['airing'] +'</option>');
				numofShow++;
			}
			//console.log(episodes[i]['s'].toString());
			//console.log(selectedSeasons.indexOf(episodes[i]['s'].toString()));
			
		}
	}
	console.log(numofShow);
  }
  
  function cleanOptions(id){
	 var select = document.getElementById(id);
     var length = select.options.length;
	 for (i = 0; i < length; i++) {
	   select.options[i] = null;
	 }
  }
</script>
<script>
      // Sniff MSIE version
      // http://james.padolsey.com/javascript/detect-ie-in-js-using-conditional-comments/
      var ie = ( function() {
        var undef,
        v = 3,
        div = document.createElement('div'),
        all = div.getElementsByTagName('i');
        while (
         div.innerHTML='<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',all[0]
        );
        return v > 4 ? v : undef;
      }() );

      function takeAction() {
        if( ie && ie < 9 ) {
	  D3notok();
        } else {
          // Load D3.js, and once loaded do our stuff
          var head = document.getElementsByTagName('head')[0];
          var script = document.createElement('script');
          script.type = 'text/javascript';
	  script.src = "js/d3.v3.min.js";
          script.addEventListener('load', D3ok, false);
          script.onload = "D3ok();";
	  head.appendChild(script);
       }
     }
    </script>
    
</head>
<body onload="takeAction();">
<h1>We are family!</h1>
<ul class="nav nav-tabs" data-tabs="tabs" id="myTabs">
    <li ><a data-toggle="tab" href="#Home">Home</a></li>
    <li class="active"><a data-toggle="tab" href="#Simpsons">Simpsons</a></li>
    <li><a data-toggle="tab" href="#Data">Data</a></li>
    <li><a data-toggle="tab" href="#About">About</a></li>
    <li><a data-toggle="tab" href="#Weekly">Weekly Report</a></li>
</ul>
<div class="tab-content">
    <div class="tab-pane" bgcolor="" id="Home">
    <div class="container">
    <div class="row">
        <div class="col-md-2">
            <h3>Project 3</h3>
            Description....
        </div>
        <div class="col-md-9">
            <img src="images/full.jpg">
        </div>
    </div>
</div>
        
    </div>
    <div class="tab-pane active" id="Simpsons">
    <div id="movieNetwork"></div>
<div id="dashboard">   
<div class="panel-group" id="accordion"> 
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
          Character
        </a>
      </h4>
    </div>
    <div id="collapseOne" class="panel-collapse collapse in">
      <div class="panel-body">
        <select id="characterSelect"></select> <br> <!--multiple="multiple"-->
        <div class="btn-group" style="margin-top:2px">
        <button type="button" class="btn btn-info"><img class="characterIcon" src="http://img2.wikia.nocookie.net/__cb20091207194310/simpsons/images/thumb/0/02/Homer_Simpson_2006.png/38px-Homer_Simpson_2006.png" height="25.5px"></button>
        <button type="button" class="btn btn-info"><img class="characterIcon" src="http://img2.wikia.nocookie.net/__cb20130908052234/simpsons/images/thumb/0/0b/Marge_Simpson.png/30px-Marge_Simpson.png" height="25.5px" ></button>
        <button type="button" class="btn btn-info"><img class="characterIcon" src="http://img1.wikia.nocookie.net/__cb20140207172456/simpsons/images/thumb/6/65/Bart_Simpson.png/33px-Bart_Simpson.png" height="25.5px"></button>
        <button type="button" class="btn btn-info"><img class="characterIcon" src="http://img1.wikia.nocookie.net/__cb20130818115621/simpsons/images/thumb/5/57/Lisa_Simpson2.png/23px-Lisa_Simpson2.png" height="25.5px"></button>
        <button type="button" class="btn btn-info"><img class="characterIcon" src="http://img2.wikia.nocookie.net/__cb20090115172358/simpsons/images/thumb/8/89/Maggie.png/25px-Maggie.png" height="25.5px"></button>
        </div><br>
        <div class="container" style="margin-top:2px"><input id="male" type="checkbox" checked="checked" > M <input id="female" type="checkbox" checked="checked"> F 
&nbsp;&nbsp;&nbsp; Age <b> 1 &nbsp;</b> <input id="ageSlider" type="text" class="span2" value="" data-slider-min="1" data-slider-max="100" data-slider-step="5" data-slider-value="[0,100]"/> <b> &nbsp;&nbsp;100</b></div>
        <button type="button" class="btn btn-default" style="margin-top:2px"><img id="selectedCharacterIcon" height="160px" width="100px" src="images/default.png"></button>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
          Season & Episode
        </a>
      </h4>
    </div>
    <div id="collapseThree" class="panel-collapse collapse">
      <div class="panel-body">
        Season <select id="seasonSelect" multiple="multiple"></select> Location <select id="locationSelect" ></select><br><br>
        Episode <select id="episodeSelect" multiple="multiple"></select>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
          Voice Actor
        </a>
      </h4>
    </div>
    <div id="collapseTwo" class="panel-collapse collapse">
      <div class="panel-body">
        
        <select id="voiceActorSelect" ></select>
      </div>
    </div>
  </div>
</div><!--dashboard-->

        </div>
        <div id="tooltip" class="hidden">
        <p><span id="value"></p>
</div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<br><br>
<div id="chart" style='overflow:auto; width:1960px; height:480px;'></div>
	    </div><!--Simpsons-->
    <div class="tab-pane" id="Data">
        <h3>Data</h3>

    </div>
    <div class="tab-pane" id="About">
        <h3>About</h3>

    </div>
    <div class="tab-pane" id="Weekly">
        <h3>Weekly Report</h3>
        <ul>
        <li><h5>Week 1</h5>
        	<ul>
        	<li>Parse the data from wikia</li>
        	<li>Design the layout<br>
	        	<img width="900px" src="images/layout_04_02.png">
        	</li>
        	</ul>
        </li>
        </ul>
        <h3>Interesting Development Findings</h3>
        <ul>
            <li>While parsing the Simpsons wikia pages, we found that "February" was misspelled as "Febuary" a few times. Our date parser also found other typos in month names. All found typos were corrected upstream.</li>
            <li>Parsing the XML wikia data dump, we noted that images or their URLs are not stored. The wiki file name (File:Foo.png) had to be retrieved/resolved to an image URL using the site's API service.</li>
        </ul>
    </div>
</div>
</body>
</html>
<script type="text/javascript">



</script>